## Find source and headers
FILE(GLOB HEADERS include/*.h)
FILE(GLOB SOURCES src/*.c*)

IF(CMAKE_HAS_SORT)
  LIST(SORT HEADERS)
  LIST(SORT SOURCES)
ENDIF(CMAKE_HAS_SORT)

## Build
INCLUDE_DIRECTORIES(
  ${NEO_CORE_INCLUDE_DIR} ${DIRENT_INCLUDE_DIR} ${LUA_INCLUDE_DIR} ${SDL_INCLUDE_DIR}
)

ADD_DEFINITIONS(-DNEO_CORE_DLL)
SET(CMAKE_SHARED_LIBRARY_PREFIX "")

IF(NOT ANDROID AND NOT EMSCRIPTEN)
  ADD_LIBRARY(NeoCore SHARED ${SOURCES} ${HEADERS})
ELSE()
  ADD_LIBRARY(NeoCore STATIC ${SOURCES} ${HEADERS})
ENDIF()

IF(NOT NO_TESTS)
  ADD_EXECUTABLE(NeoCoreTest tests/main.cpp)

  ## Travis does not like TARGET_INCLUDE_DIRECTORIES
  INCLUDE_DIRECTORIES(${GTEST_INCLUDE_DIR})
  TARGET_LINK_LIBRARIES(NeoCoreTest ${GTEST_LIBRARIES} ${NEO_CORE_LIBRARIES})
ENDIF()

## Install for Editor
INSTALL(TARGETS NeoCore DESTINATION ${NEO_INSTALL_DIR})

## Install for SDK
INSTALL(TARGETS NeoCore DESTINATION ${NEO_INSTALL_DIR}/SDK/lib COMPONENT sdk)
INSTALL(FILES ${HEADERS} DESTINATION ${NEO_INSTALL_DIR}/SDK/include/NeoCore COMPONENT sdk)
